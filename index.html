<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>æ‹¼éŸ³å¤§å†’é™© - Dollyçš„æ‹¼éŸ³å­¦ä¹ æ¸¸æˆ</title>
  <link rel="stylesheet" href="css/style.css">
  <style>
    /* åŠ è½½åŠ¨ç”» */
    #loading {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: linear-gradient(135deg, #ff69b4, #ff85c8);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      color: white;
      z-index: 9999;
      transition: opacity 0.5s;
    }
    #loading.hidden { opacity: 0; pointer-events: none; }
    #loading .loading-heart {
      font-size: 80px;
      animation: pulse 1s infinite;
    }
    #loading h1 { font-size: 36px; margin-top: 20px; }
    #loading p { font-size: 16px; opacity: 0.8; margin-top: 10px; }
  </style>
</head>
<body>
  <!-- åŠ è½½ç”»é¢ -->
  <div id="loading">
    <div class="loading-heart">ğŸ©·</div>
    <h1>æ‹¼éŸ³å¤§å†’é™©</h1>
    <p>æ­£åœ¨å‡†å¤‡å†’é™©...</p>
  </div>

  <!-- åº”ç”¨å®¹å™¨ -->
  <div id="app"></div>

  <!-- æŒ‰é¡ºåºåŠ è½½è„šæœ¬ -->
  <script src="https://cdn.jsdelivr.net/npm/vosk-browser@0.0.8/dist/vosk.js"></script>
  <script src="js/pinyin-data.js"></script>
  <script src="js/data.js"></script>
  <script src="js/mastery.js"></script>
  <script src="js/error-book.js"></script>
  <script src="js/speech.js?v=3"></script>
  <script src="js/game.js?v=3"></script>
  <script src="js/app.js?v=3"></script>
  <script>
    // é¡µé¢åŠ è½½ï¼šå…ˆåŠ è½½ Vosk æ¨¡å‹ï¼Œå†éšè—åŠ è½½ç”»é¢
    window.addEventListener('load', async () => {
      const loadingText = document.querySelector('#loading p');

      // é¢„åŠ è½½ Vosk è¯­éŸ³æ¨¡å‹ï¼ˆ32MBï¼Œé¦–æ¬¡ä¸‹è½½åæµè§ˆå™¨ç¼“å­˜ï¼‰
      if (SpeechModule.isSupported) {
        if (loadingText) loadingText.textContent = 'æ­£åœ¨åŠ è½½è¯­éŸ³æ¨¡å‹...';
        const modelUrl = new URL('model.tar.gz?v=2', window.location.href).href;
        const ok = await SpeechModule.loadModel(modelUrl);
        if (ok) {
          App._voskModelReady = true;
          console.log('[Init] Vosk æ¨¡å‹åŠ è½½å®Œæˆ');
        } else {
          console.warn('[Init] Vosk æ¨¡å‹åŠ è½½å¤±è´¥ï¼Œè¯­éŸ³åŠŸèƒ½ä¸å¯ç”¨');
        }
      }

      if (loadingText) loadingText.textContent = 'å‡†å¤‡å®Œæ¯•!';
      setTimeout(() => {
        document.getElementById('loading').classList.add('hidden');
        setTimeout(() => document.getElementById('loading').remove(), 500);
      }, 300);
    });
  </script>
</body>
</html>
